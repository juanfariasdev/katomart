from __future__ import annotations

from dataclasses import dataclass
from typing import List

import requests

from src.platforms.base import PlatformFactory



MEMBERSHIP_BASE_URL = "https://katomaro.com"


@dataclass(frozen=True)
class MembershipInfo:
    """Represents the response from the membership authentication API."""

    token: str
    allowed_platforms: List[str]
    is_premium: bool
    permissions: List[str]
    user_email: str


class MembershipService:
    """Client to authenticate the user with the Katomart membership backend."""

    def __init__(self, timeout: int = 15) -> None:
        self._base_url = MEMBERSHIP_BASE_URL.rstrip("/")
        self._timeout = timeout

    def authenticate(self, email: str, password: str) -> MembershipInfo:

        permissions = ["katomaro.FULL"]

        has_full_permission = True
        allowed = PlatformFactory.get_platform_names()

        token = ""

        return MembershipInfo(
            token=token,
            allowed_platforms=allowed,
            is_premium=has_full_permission,
            permissions=permissions,
            user_email="admin@admin.com",
        )
